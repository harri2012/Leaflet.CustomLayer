{"version":3,"file":"Leaflet.CustomLayer.min.js","sources":["../src/Leaflet.CustomLayer.js"],"sourcesContent":["import L from \"leaflet\";\n\n/*\n// Exmaple\nvar customLayer = new L.customLayer({\n  el: document.createElement(element), // The DomElement object to display\n  zooms: [0, 18], // Set the visibility level, [min, max]\n  opacity: 1, // The opacity of the layer, [0,1]\n  visible: true, // Is the layer visible\n  zIndex: 120, // The zIndex of the layer\n  alwaysRender: true // Whether to redraw during zoom panning, complex drawing suggestions are set to false\n});\n\ncustomLayer.layerWillMount = function() {\n  console.log(\"layerWillMount\");\n};\n\ncustomLayer.layerDidMount = function() {\n  console.log(\"layerDidMount\");\n};\n\ncustomLayer.layerRender = function() {\n  console.log(\"layerRender\");\n};\n\ncustomLayer.layerWillUnmount = function() {\n  console.log(\"WillUnmount\");\n};\n\ncustomLayer.layerDidUnmount = function() {\n  console.log(\"DidUnmount\");\n}\n\ncustomLayer.addTo(map);\n*/\n\nclass CustomLayer extends (L.Layer ? L.Layer : L.Class) {\n  constructor(definition) {\n    super(definition);\n\n    const _definition = {\n      el: null, // The DomElement object to display\n      zooms: [0, 18], // Set the visibility level, [min, max]\n      opacity: 1, // The opacity of the layer, [0,1]\n      visible: true, // Is the layer visible\n      zIndex: 120, // The zIndex of the layer\n      alwaysRender: true, // Whether to redraw during zoom panning, complex drawing suggestions are set to false\n      layerWillMount: null, // Lifecycle - before adding a layer\n      layerDidMount: null, // Lifecycle - after the layer is added\n      layerRender: null, // Lifecycle - render\n      layerWillUnmount: null, // Lifecycle - before layer removal\n      layerDidUnmount: null, // Lifecycle - layer has been removed\n      ...definition\n    };\n\n    const _options = {\n      el: _definition.el,\n      opacity: _definition.opacity,\n      visible: _definition.visible,\n      zIndex: _definition.zIndex,\n      zooms: _definition.zooms,\n      alwaysRender: _definition.alwaysRender\n    };\n    L.setOptions(this, _options);\n\n    if (typeof _definition.layerWillMount === \"function\") {\n      this.layerWillMount = _definition.layerWillMount;\n    }\n    if (typeof _definition.layerDidMount === \"function\") {\n      this.layerDidMount = _definition.layerDidMount;\n    }\n    if (typeof _definition.layerRender === \"function\") {\n      this.layerRender = _definition.layerRender;\n    }\n    if (typeof _definition.layerWillUnmount === \"function\") {\n      this.layerWillUnmount = _definition.layerWillUnmount;\n    }\n    if (typeof _definition.layerDidUnmount === \"function\") {\n      this.layerDidUnmount = _definition.layerDidUnmount;\n    }\n  }\n\n  // Built-in life cycle\n  beforeAdd(map) {\n    this._map = map;\n\n    // register Events\n    this._registerEvents = false;\n    this._eventType = \"\";\n    this._zoomVisible = true;\n\n    // --If the Element instance already exists, simulate a position offset eventã€‚\n    // (the map position changes when the layer is removed from the map, and if the layer is added to the map at a time, it will deviate)\n    if (this.getElement()) {\n      this._animateZoom({\n        center: this._map.getCenter(),\n        zoom: this._map.getZoom(),\n        noUpdate: undefined,\n        type: \"zoomanim\",\n        target: this._map,\n        sourceTarget: this._map\n      });\n    }\n\n    this.layerWillMount && this.layerWillMount.bind(this)();\n  }\n\n  getEvents() {\n    this._registerEvents = true;\n    // Layer trigger priority\n    // move: movestart -> move -> moveend\n    // zoom: zoomstart -> movestart -> zoomanim -> zoom -> move -> zoomend -> moveend\n    // resize: move -> resize -> moveend\n    let events = {\n      resize: this._onLayerResize,\n      movestart: this._onLayerMovestart,\n      move: this._onLayerMove,\n      moveend: this._onLayerMoveend,\n      zoomstart: this._onLayerZoomstart,\n      zoom: this._onLayerZoom,\n      zoomend: this._onLayerZoomend\n    };\n    if (this._map.options.zoomAnimation && L.Browser.any3d) {\n      events.zoomanim = this._onLayerZoomanim;\n    }\n\n    return events;\n  }\n\n  onAdd(map) {\n    this._map = map;\n\n    const el = this.getElement();\n\n    const size = this._map.getSize();\n    this._setElementSize(size);\n\n    this.setOpacity(this.options.opacity);\n    this.setZIndex(this.options.zIndex);\n\n    const animated = this._map.options.zoomAnimation && L.Browser.any3d;\n    L.DomUtil.addClass(el, \"leaflet-layer\");\n    L.DomUtil.addClass(el, `leaflet-zoom-${animated ? \"animated\" : \"hide\"}`);\n\n    if (!this._registerEvents) {\n      this._map.on(this.getEvents(), this);\n    }\n\n    if (!this.options.visible) {\n      console.log(this.options.visible);\n      this._map.off(this.getEvents(), this);\n      return;\n    }\n\n    this._map.getPanes().overlayPane.appendChild(el);\n\n    this.layerDidMount && this.layerDidMount.bind(this)();\n\n    if (!this.options.visible) {\n      this.hide();\n    }\n\n    this._needRedraw();\n  }\n\n  onRemove(map) {\n    this.layerWillUnmount && this.layerWillUnmount.bind(this)();\n\n    if (this._frame) {\n      L.Util.cancelAnimFrame(this._frame);\n      this._frame = null;\n    }\n\n    try {\n      this._map.getPanes().overlayPane.removeChild(this.getElement());\n    } catch (e) {}\n\n    if (this._registerEvents) {\n      this._registerEvents = false;\n      this._map.off(this.getEvents(), this);\n    }\n    this._map.off({ zoom: this._onZoomVisible }, this);\n\n    this.layerDidUnmount && this.layerDidUnmount.bind(this)();\n  }\n\n  _render() {\n    this.layerRender && this.layerRender.bind(this)();\n    this._frame = null;\n  }\n\n  // Built-in Event\n  _onLayerResize(event) {\n    if (this._eventType !== \"\") return;\n    this._eventType = \"resize\";\n    if (this._eventType !== \"resize\") return;\n    // resize\n    this._setElementSize(event.newSize);\n    this._setElementPosition();\n    this._render();\n\n    this._eventType = \"\";\n  }\n  _onLayerMovestart(event) {\n    if (this._eventType !== \"\") return;\n    this._eventType = \"move\";\n    if (this._eventType !== \"move\") return;\n    // movestart\n  }\n  _onLayerMove(event) {\n    if (this._eventType !== \"move\") return;\n    if (!this.options.alwaysRender) return;\n    // move\n    this._setElementPosition();\n    this._render();\n  }\n  _onLayerMoveend(event) {\n    if (this._eventType !== \"move\") return;\n    // moveend\n    this._setElementPosition();\n    this._render();\n\n    this._eventType = \"\";\n  }\n  _onLayerZoomstart(event) {\n    if (this._eventType !== \"\") return;\n    this._eventType = \"zoom\";\n    if (this._eventType !== \"zoom\") return;\n    // zoomstart\n  }\n  _onLayerZoomanim(event) {\n    if (this._eventType !== \"zoom\") return;\n    // zoomanim\n    this._animateZoom(event);\n  }\n  _onLayerZoom(event) {\n    if (this._eventType !== \"zoom\") return;\n    if (!this.options.alwaysRender) return;\n    // zoom\n    if (!this._isZoomVisible()) {\n      this._zoomHide();\n      this._eventType = \"\";\n      return;\n    }\n\n    this._setElementPosition();\n    this._render();\n  }\n  _onLayerZoomend(event) {\n    if (this._eventType !== \"zoom\") return;\n    // zoomend\n    if (!this._isZoomVisible()) {\n      this._zoomHide();\n      this._eventType = \"\";\n      return;\n    }\n\n    this._setElementPosition();\n    this._render();\n\n    this._eventType = \"\";\n  }\n  _onZoomVisible() {\n    if (this._isZoomVisible()) {\n      this._zoomShow();\n    } else {\n      this._zoomHide();\n    }\n  }\n\n  // Built-in Methods\n  _needRedraw() {\n    if (!this._frame) {\n      this._frame = L.Util.requestAnimFrame(this._render, this);\n    }\n    return this;\n  }\n\n  _setElementSize(size) {\n    const element = this.getElement();\n    element.setAttribute(\"width\", size.x);\n    element.setAttribute(\"height\", size.y);\n    element.style.width = size.x + \"px\";\n    element.style.height = size.y + \"px\";\n  }\n  _setElementPosition(point = [0, 0]) {\n    const topLeft = this._map.containerPointToLayerPoint(point);\n    L.DomUtil.setPosition(this.getElement(), topLeft);\n  }\n\n  // L.DomUtil.setTransform stand-in\n  _setTransform(el, offset, scale) {\n    const pos = offset || new L.Point(0, 0);\n\n    el.style[L.DomUtil.TRANSFORM] =\n      (L.Browser.ie3d\n        ? `translate(${pos.x}px, ${pos.y}px)`\n        : `translate3d(${pos.x}px, ${pos.y}px, 0)`) +\n      (scale ? ` scale(${scale})` : \"\");\n  }\n\n  _animateZoom(e) {\n    let scale = this._map.getZoomScale(e.zoom);\n    // -- different calc of animation zoom  in leaflet 1.0.3 thanks @peterkarabinovic, @jduggan1\n    const offset = L.Layer\n      ? this._map._latLngBoundsToNewLayerBounds(\n          this._map.getBounds(),\n          e.zoom,\n          e.center\n        ).min\n      : this._map\n          ._getCenterOffset(e.center)\n          ._multiplyBy(-scale)\n          .subtract(this._map._getMapPanePos());\n\n    (L.DomUtil.setTransform || this._setTransform)(\n      this.getElement(),\n      offset,\n      scale\n    );\n  }\n\n  _isZoomVisible() {\n    const minZoom = this.options.zooms[0];\n    const maxZoom = this.options.zooms[1];\n    const zoom = this._map.getZoom();\n\n    const isVisible = zoom >= minZoom && zoom <= maxZoom;\n\n    return isVisible;\n  }\n\n  _zoomShow() {\n    if (this._zoomVisible) return;\n    this._zoomVisible = true;\n\n    this._map.off({ zoom: this._onZoomVisible }, this);\n\n    if (!this.options.visible) return;\n    this._map.on(this.getEvents(), this);\n    this._map.getPanes().overlayPane.appendChild(this.getElement());\n    this._setElementPosition();\n    this._render();\n  }\n\n  _zoomHide() {\n    if (!this._zoomVisible) return;\n    this._zoomVisible = false;\n\n    this._map.off(this.getEvents(), this);\n    this._map.on({ zoom: this._onZoomVisible }, this);\n\n    try {\n      this._map.getPanes().overlayPane.removeChild(this.getElement());\n    } catch (e) {}\n  }\n\n  // API\n  addTo(map) {\n    map.addLayer(this);\n    return this;\n  }\n\n  getElement() {\n    return this.options.el;\n  }\n\n  setElement(element) {\n    this.options.el = element;\n  }\n\n  getOpacity() {\n    return this.options.opacity;\n  }\n\n  setOpacity(opacity) {\n    this.getElement().style.opacity = this.options.opacity = opacity;\n    return opacity;\n  }\n\n  getZIndex() {\n    return this.options.zIndex;\n  }\n\n  setZIndex(zIndex) {\n    this.getElement().style.zIndex = this.options.zIndex = zIndex;\n    return zIndex;\n  }\n\n  show() {\n    if (this.options.visible) return;\n    this.options.visible = true;\n\n    this._map.on({ zoom: this._onZoomVisible }, this);\n    this._onZoomVisible();\n  }\n\n  hide() {\n    if (!this.options.visible) return;\n    this.options.visible = false;\n\n    this._map.off(this.getEvents(), this);\n    this._map.off({ zoom: this._onZoomVisible }, this);\n\n    try {\n      this._map.getPanes().overlayPane.removeChild(this.getElement());\n    } catch (e) {}\n  }\n}\n\nfunction customLayer(definition) {\n  return new CustomLayer(definition);\n}\n\n/**\n * Plugin Props\n */\n\nL.CustomLayer = CustomLayer;\nL.customLayer = customLayer;\n\n/**\n * Exports\n */\n\nexport { CustomLayer };\nexport { customLayer };\nexport default customLayer;\n"],"names":["CustomLayer","definition","_definition","el","zooms","opacity","visible","zIndex","alwaysRender","layerWillMount","layerDidMount","layerRender","layerWillUnmount","layerDidUnmount","_options","L","setOptions","Layer","Class","map","_map","_registerEvents","_eventType","_zoomVisible","this","getElement","_animateZoom","center","getCenter","zoom","getZoom","noUpdate","undefined","type","target","sourceTarget","bind","events","resize","_onLayerResize","movestart","_onLayerMovestart","move","_onLayerMove","moveend","_onLayerMoveend","zoomstart","_onLayerZoomstart","_onLayerZoom","zoomend","_onLayerZoomend","options","zoomAnimation","Browser","any3d","zoomanim","_onLayerZoomanim","size","getSize","_setElementSize","setOpacity","setZIndex","animated","DomUtil","addClass","on","getEvents","console","log","off","getPanes","overlayPane","appendChild","hide","_needRedraw","_frame","Util","cancelAnimFrame","removeChild","e","_onZoomVisible","event","newSize","_setElementPosition","_render","_isZoomVisible","_zoomHide","_zoomShow","requestAnimFrame","element","setAttribute","x","y","style","width","height","point","topLeft","containerPointToLayerPoint","setPosition","offset","scale","pos","Point","TRANSFORM","ie3d","getZoomScale","_latLngBoundsToNewLayerBounds","getBounds","min","_getCenterOffset","_multiplyBy","subtract","_getMapPanePos","setTransform","_setTransform","minZoom","maxZoom","addLayer","customLayer"],"mappings":"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"}