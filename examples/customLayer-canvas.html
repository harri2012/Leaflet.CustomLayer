<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaflet customLayer-canvas 1.4.0</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
    }
    #map {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
<div id="map"></div>
<div width="500" height="800" style="background: #000;"></div>
<script src="../dist/Leaflet.CustomLayer.js"></script>
<script>
  var map = L.map("map", {
    zoomAnimation: true
  }).setView([36.8, 108.34], 3);

  // 贴图
  L.tileLayer("https://{s}.tiles.mapbox.com/v4/mapbox.dark/{z}/{x}/{y}@2x.png?access_token=pk.eyJ1IjoiZ2xlYWZsZXQiLCJhIjoiY2lxdWxoODl0MDA0M2h4bTNlZ2I1Z3gycyJ9.vrEWCC2nwsGfAYKZ7c4HZA")
    .addTo(map);

  var drawCanvas = function(canvas) {
    var context = canvas.getContext('2d');
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.fillStyle = 'rgb(0,100,255)';

    let point = map.latLngToContainerPoint({
      lat: 34.32337805545791,
      lng: 109.01905059814455
    })
    context.fillRect(point.x, point.y, 100
      , 100);
  }

  var canvasLayer = new L.CustomLayer({
    el: document.createElement("canvas"), // 图层DomElement
    zooms: [0, 18], // 图层可见级别
    opacity: 1, // 图层透明度
    visible: true, // 图层是否可见
    zIndex: 120, // 图层层级
    alwaysRender: true // 缩放平移过程中是否重绘，复杂绘制建议设为false
  });
  // 生命周期-图层添加前
  canvasLayer.layerWillMount = function() {
    console.log("layerWillMount");
  };
  // 生命周期-图层添加后
  canvasLayer.layerDidMount = function() {
    console.log("layerDidMount");
  };
  // 生命周期-渲染钩子
  canvasLayer.layerRender = function() {
    console.log("layerRender");
    console.log(this.getElement(), 1);
    drawCanvas(this.getElement());
  };
  // 生命周期-图层移除前
  canvasLayer.layerWillUnmount = function() {
    console.log("WillUnmount");
  };
  // 生命周期-图层已卸载
  canvasLayer.layerDidUnmount = function() {
    console.log("DidUnmount");
  }
  canvasLayer.addTo(map);

  console.log(canvasLayer);
</script>
</body>
</html>
